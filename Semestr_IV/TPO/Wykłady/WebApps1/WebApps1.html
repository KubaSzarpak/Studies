<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
<meta http-equiv="Content-Type"
 content="text/html; charset=windows-1250"> <meta name="author"
 content="Krzysztof Barteczko"> <meta name="description"
 content="TPR"> <meta name="copyright"
 content="(c) Krzysztof Barteczko PJWSTK 2008"> <link rel="stylesheet"
 type="text/css" href="../STYLE/common.css"> <title>Aplikacje WEB (1)</title></head>
<body><div align="center">
<a name="WebApps"></a><a name="WebApps1"></a><h1>Aplikacje WEB (1)</h1>
</div><hr>
<span style="font-style: italic;">Aplikacje WEB stanowi¹ istotny
element wspó³czesnych systemów informatycznych.
Umo¿liwiaj¹ one dostêp i interakcjê do rozlicznych serwisów i systemów
informatycznych
w œrodowisku rozproszonym, sieciowym, przy wykorzystaniu&nbsp;prostych
i
uniwersalnych protoko³ów. Temat jest niezwykle rozleg³y, móg³by
stanowiæ
w³aœciwie treœæ odrêbnej, du¿ej monografii. Tutaj przedstawimy
wprowadzenie
do tej tematyki, staraj¹c sie przy tym podaæ podstawy -&nbsp; niezbêdne
i przydatne
do dalszego studiowania technologii programowania aplikacji WEB. W
pierwszej czeœci zajmiemy siê tworzeniem prostych serwletów i
zgadnieniem ich wdra¿ania.</span><br>
<hr><a name="WebApps.1"></a><a name="WebApps1.1"></a><h2>1. Technologie programowania aplikacji
WEB</h2>
Korzystaj¹c z Internetu na co dzieñ stykamy siê z aplikacjami WEB. <br>
<br><div class="def">Aplikacje WEB stanowi¹ zestaw komponentów
programistycznych, dzia³aj¹cych
po stronie serwera i dynamicznie reaguj¹cych na zlecenia ze strony
programów&nbsp;
klienckich, zg³aszane za poœrednictwem protoko³u sieciowego (w
szczególnoœci
HTTP). </div><br>
<br>Aplikacje WEB maj¹ szerokie zastosowania, g³ównie w Internecie i
intranecie, obejmuj¹ce m.in.:<br>
<ul> <li>dynamiczne generowanie treœci stron WWW,</li> <li>proste,
bezpoœrednie przetwarzanie zleceñ klienckich,</li> <li>kontrolowanie
komunikacji z klientami - statystyki, zabezpieczenia, odtwarzanie
informacji (sesje, cookies),</li> <li>dostarczanie informacji z baz
danych,</li> <li>poœredniczenie pomiêdzy programami klienckimi, a
systemami informacyjnymi
firmy w wykonywaniu zadañ z zakresu z³o¿onej logiki biznesowej.</li>
</ul>Wspomniane programy klienckie s¹ zazwyczaj przegl¹darkami stron
WWW (ze wzglêdu
na uniwersalny, powszechnie dostêpny charakter tego interfejsu), ale
mog¹
równie¿ obejmowaæ takie komponenty jak aplety, czy nawet stanowiæ
wyspecjalizowane
"wolnostoj¹ce" programy. Takie programy i takie aplety bed¹ wtedy
stanowiæ
"klienck¹" czêsæ aplikacji WEB. W ka¿dym przypadku jednak j¹drem
aplikacji s¹ komponenty
dzia³aj¹ce po stronie serwera.<br>
<br>Œrodowisko Javy doskonale nadaje siê do tworzenia aplikacji WEB,
bowiem:<br>
<ul> <li>dostarcza wyspecjalizowanych technologii tworzenia tzw.
web-komponentów,
czyli komponentów, które obs³uguj¹ zlecenia, a w szczególnoœci potrafi¹
reagowaæ
na nie dynamiczn¹ generacj¹ treœci,</li> <li>implementuje koncepcje
programowania kompnentowego (JavaBeans), co
sprzyja nie tylko prostocie tworzenia aplikacji (np. w œrodowiskach
programistycznych),
ale równie¿, czy mo¿e przede wszystkim, elastycznemu separowaniu treœci
i
prezentacji,</li> <li>zapewnia uniwersalny, spójny z innymi œrodkami
jêzyka, mechanizm dostêpu do baz danych (JDBC),</li> <li>wzmacnia to
wszystko bogactwem standardowych pakietów Javy, które
-&nbsp; oczywiœcie - mo¿emy wykorzystywaæ na poziomie apliakacji WEB.</li>
</ul>Przyk³adowy schemat dzia³ania aplikacji WEB pokazuje rysunek.<br>
<br>Rys. Dzia³anie aplikacji WEB<br><br><img
 style="border: 1px solid ; width: 605px; height: 393px;" alt="r"
 src="images/IntroIWAa.gif"><br><br>1 - zlecenie klienta<br>2 -
odebrane przez kompoenn WEB<br>3 - odow³anie do klas realizuj¹cych
logikê<br>4,5 - siêgniêcie po dane i ich odbiór<br>6&nbsp;-
&nbsp;komponent WEB odbira wyniki pretwarzania,<br>7,8 - przekazanie
wyników klientowi<br>
<br>Podstawow¹ technologi¹, s³u¿¹c¹ w Javie do tworzenia aplikacji WEB
jest technologia <b>serwletów</b> (<b>Java Servlet Technology</b>).<br>
<br><div class="def"><b>Serwlet</b> jest klas¹ Javy, rozszerzaj¹c¹
funkcjonalnoœæ serwerów
w przetwarzaniu zleceñ programów klienckich.<br>Przy programowaniu
serwletów
wykorzystujemy klasy z pakietu &nbsp;javax.servlet - stanowi¹cego
interfejs programistyczny
Servlet API. Klasy te i ich metody dostarczaj¹ ró¿norodnych œrodków
odbierania
i reagowania na zlecenia klientów oraz przesy³ania im wyników
(odpowiedzi).</div><br>
<br> Serwlet mo¿e (a nawet powinien) pelniæ rolê kontrolera w
aplikacjach
WEB budowanych w oparciu o paradygmat "Model-View-Controller" i
zajmowaæ
siê odbieraniem zleceñ, zarz¹dzaniem nimi, przekazywaniem ich innym
komponentom
programowym, odbieraniem od nich wyników i przekazywaniem modu³om
prezentacyjnym.
Wa¿ne jest przy tym, by w strukturze aplikacji WEB wystêpowa³a wyra¿na
separacja
pomiêdzy danymi, a ich prezentacj¹.<br>
Technologia serwletów - jako najwczeœniejsza technologia programowania
komponentów
Web w Javie - nie wymusza jednak spe³nienia tego wymagania. Nader
czêsto
serwlety u¿ywane by³y (i s¹) do generowania dynamicznych stron WWW w
taki
sposób, ¿e kod odpowiedzialny za prezentacjê (tworzenie wygl¹du strony)
zmieszany
jest z kodem, odpowiedzialnyn za logikê przetwarzania danych.
Niejednokrotnie
takiego pomieszania - w przypadku "czystych" serwletów trudno jest
unikn¹æ.<br>
<br>Technologia <b>Java Server Pages (JSP)</b> po czêœci odpowiada na
to wyzwanie,
jednoczeœnie nieco upraszczaj¹c tworzenie czeœci aplikacji webowych,
szczególnie
tych odpowiedzialnych za wygl¹d.&nbsp; Traktowana najpierw jako g³ównie
swoisty
jêzyk skryptowy (strona JSP zawiera statyczn¹ treœæ np. w jêzyku HTML
oraz
treœæ dynamiczn¹, generowan¹ przez elementy JSP), obecnie akcentuje
deklaratywne
<b>znaczniki</b>, które - w trakcie interpretacji strony - "wywo³uj¹"
okreœlone
procedury.&nbsp; Wprowadzeniu standardowej biblioteki znaczników <b>(Java
Server Pages Standard Tag Library)</b> da³o twórcom aplikacji WEB
uniwersalne i stosunkowo ³atwe (przede wszystkim
dla tych co nie znaj¹ Javy)&nbsp; sposoby uzyskiwania ró¿norodnej
funckjonalnoœci.<br>
W pewnym sensie JSP jest "tylko" nak³adk¹ na serwlety: istotnie strony
JSP
s¹ - przy pierwszym do nich odwo³aniu - t³umaczone na serwlety, a te
ostatnie
sa kompilowane "w locie" i wykonywane przez serwer aplikacji.<br>
<br> I wreszcie, swoistym uzupe³nieniem do "czystych" serwletów i JSP
jest&nbsp;technologia&nbsp;<b>Java Server Faces</b>
. przeznaczona do elastycznego generowania GUI aplikacji WEB po stronie
serwera, ale przede
wszystkim umo¿liwiaj¹ca lepsz¹ separacjê modeli i widoków, której -
mimo wszystko - JSP do koñca nie zapewnia.<br>
<br>Relacje pomiêdzy podstawowymi technologiami Javy, s³u¿¹cymi
tworzeniu aplikacji WEB przedstawia rysunek.<br><br><img
 style="border: 1px solid ; width: 528px; height: 248px;" alt="r"
 src="images/IntroIWAa2.gif"><br><br>Nowe
trendy w tworzeniu aplikacji WEB dotykaj¹ przede wszystkim u³atwionych
sposobów programowania (tutaj wymieniæ mo¿na œrodowisko Grails = Groovy
on Rails), a tak¿e zmian po stronie programowania klientów, zwi¹zanych
z zastosowaniem rozbudowanych bibliotek JavaScript i technologii (czy
raczej podejœcia) AJAX. AJAX (Asynchrounous Java Script and XML) polega
na &nbsp;asynchronicznym (nie wymagaj¹cym prze³adowania stron)
odbierania przez klienta danych od serwera, co umozliwia tworzenie
prawdziwie interaktywnych stron WEB.<br>Omówimy zagadnienia zwi¹zane z
konstrukcj¹, rozwijaniem
i wdra¿eniem aplikacji WEB, skupiaj¹c uwagê na serwletach. Niestety,
ograniczona
objêtoœæ nie pozwala na pe³niejsze przedstawienie technologii JSP i
Java Server Faces.
Ta pierwsza jest zreszt¹ technologi¹ raczej "nieprogramistyczn¹".&nbsp;<br>
Co wiêcej, w przypadku obu tych technologii mamy wyraŸne odniesienia do
serwletów,
które stanowi¹ dla nich bazê. Dlatego opanowanie programowania
aplikacji
WEB g³ównie pod k¹tem serwletów nie jest strat¹ czasu: bêdzie sprzyjaæ
³atwiejszemu
i pe³niejszemu rozumieniu rozszerzaj¹cych mechanizmów JSP i JSF.&nbsp;<br>Równie¿&nbsp;AJAX
dobrze wpisuje siê w zastosowania serwletów jako podstawoego
"budulca"&nbsp; modu³ów dzialaj¹cych po stronie serwera.<br>
&nbsp;<hr style="width: 100%; height: 2px;"><a name="WebApps.2"></a><a name="WebApps1.2"></a><h2>2.
Struktura i kontekst aplikacji WEB</h2>Aplikacje WEB wykonywane
s¹ w œrodowisku serwerów aplikacji. Serwery zarz¹dzaj¹ aplikacjami i
ich wykonaniem
(np. w szczególnoœci ³adowaniem i wywo³ywaniem serwletów,
przekazywaniem
zleceñ, polityk¹ bezpieczeñstwa itp.). Aby to robiæ, serwery musz¹ mieæ
dostêp
do informacji o aplikacji, jej umiejscowieniu i pewnych w³aœciwoœciach.
&nbsp;
Nie wystarczy zatem samo oprogramowanie i skompilowanie programów
(klas),
trzeba jeszcze aplikacjê skonfigurowaæ, distarczyæ odpowiednich
informacji
o niej oraz odpowiednio umiejscowiæ. Nazywa siê to <b>wdro¿eniem </b>(deployment)
aplikacji.<br>
<br> Istnieje wiele ró¿nych <span style="font-weight: bold;">serwerów
aplikacji</span> (np. IBM WebSphere, JBoss,
BEA WebLogic),&nbsp; które wraz z obs³ug¹ aplikacji WEB œwiadcz¹ us³ugi
typu "middleware"
w oparciu o platformê Enterprise Java Beans (w ramach tych serwerów
aplikacji
mo¿na wyró¿niæ serwer EJB i serwer WEB). &nbsp;Istniej¹ te¿ samodzielne
serwery
WEB, które zajmuj¹ siê przede wszystkim obs³ug¹ aplikacji WEB (np.
Tomcat), ew. dodatkowo umiej¹c ³¹czyæ sie z serwerami EJB.<br>
Proces wdra¿ania aplikacji WEB na wszystkich tych serwerach jest ideowo
podobny i (ogólnie) polega na:<br>
<ul> <li>stworzeniu pliku tzw. <b>deskryptora wdro¿enia</b> <b>(web
deployment descriptor</b>) o nazwie <b>web.xml</b>,</li> <li>
ew. stworzenie dodatkowych specjalnych&nbsp; plików opisowych (np. dla
bibliotek znaczników JSP),</li> <li>
umiejscowienie wszystkich komponentów aplikacji (klas, stron HTML,
stron
JSP, plików graficznych i dŸwiêkowych) oraz pliku deskryptora wdro¿enia
w
odpowiedniej, œciœle okreœlonej, strukturze katalogowej,</li> <li>
dostarczenie serwerowi &nbsp;œcie¿ki kontekstu aplikacji (<b>context-path</b>).</li>
</ul>Zacznijmy od koñca. Ka¿da aplikacja WEB ma swój <b>kontekst&nbsp;</b>
swoiste
œrodowisko izolowane od innych aplikacji dzia³aj¹cych na danym
serwerze.
Kontekst umo¿liwia m.in wymianê i dzielenia informacji pomiêdzy
komponentami
tej samej aplikacji (np. róznymi serwletami, które stanowia jej
komponenty),
jak równie¿ komunikowanie siê aplikacji z serwerem. Serwer uruchamia
aplikacjê
w jej kontekœcie (tworzy dla niej kontekst) i identyfikuje j¹ poprzez
nazwê
kontekstu (œcie¿kê kontekstu). Aplikacja jest reprezentowana przez jej
kontekst. Œcie¿ka kontekstu s³u¿y tak¿e do wywo³ywania
aplikacji lub jej czêœci z poziomu programów klienckich. Pomiêdzy
œcie¿k¹
kontekstu a realnym umiejscowieniem&nbsp; struktury katalogowej
aplikacji na fizycznej
maszynie musi byæ ustanowiona&nbsp; odpowiednioœæ (inaczej serwer nie
odnalaz³by
komponentów aplikacji). <br>
<br><b>Struktura katalogowa aplikacji </b>jest œciœle okreœlona.
Komponenty i deskryptory aplikacji musz¹ byæ ulokowane w nastêpuj¹cy
sposób:<br>
<br><img src="images/StruktWebAp.jpg" alt="r" height="531" width="524">
<br><br>
G³ówny katalog aplikacji - MojaAp (1) zawiera katalog WEB-INF oraz
mo¿e, ale nie musi zawieraæ strony
JSP, a tak¿e dowolne komponenty typu dokumenty HTML, XML. pliki
graficzne
itp. (dostêpne dla u¿ytkownika).<br>
Kluczow¹ rolê spe³nia podkatalog WEB-INF (2). Zawiera on:<br>
<ul> <li>plik deskryptora wdro¿enia (<b>web.xml</b>) - <b>koniecznie!</b></li>
<li>pliki deskryptorów znaczników bobliotek JSP (z rozszerzeniem *.tld)
- o ile stosujemy biblioteki znaczników,</li> <li>plik konfiguracji
Java Server Faces (faces-config.xml) - o ile stosujemy JSF,</li> <li>podkatalog
lib (5), zawieraj¹cy dzielone biblioteki (pakiety) Javy
w postaci plików JAR - jeœli tylko nasze klasy tego wymagaj¹ ,</li> <li>podkatalog
<b>classes</b> (4), który zawiera skompilowane klasy Javy
(m.in. serwlety, ale równie¿ inne); je¿eli klasy nale¿¹ do nazwanych
pakietów,
to musz¹ byæ umieszczane w odpowiednich podkatalogach katalogu class.</li>
</ul>Ta struktura katalogowa odwzorowywana jest na <b>œcie¿kê kontekstu</b>
przy wdro¿eniu.<br>
<br><br><a name="WebApps1.3"></a><h2>3. Wdra¿anie i uruchamianie aplikacji WEB.&nbsp; Deskryptor
wdro¿enia</h2>
W œrodowisku serwera Tomcat (<u>a bêdziemy pos³ugiwaæ siê i omawiaæ
konkretne
przyk³ady w³aœnie dla Tomcata</u>)&nbsp; istniej¹ trzy sposoby <b>wdro¿enia</b>
gotowej aplikacji, przygotowanej w pokazanej wy¿ej strukturze
katalogowej:<br>
<ul> <li><b>skopiowanie</b> tej struktury do katalogu okreslanego
przez w³aœciwoœæ <b>appbase</b> konfiguracji serwera;
standardowo-&nbsp; katalogu <b>webapps</b>, znajduj¹cym
siê w katalogu instalacyjnym Tomcata - œcie¿k¹ kontekstu
dla schematu z rysunku bêdzie wtedy /MojaAp (lub - jeœli nie kopiujemy
ca³ego katalogu
MojaAp, lecz tworzymy&nbsp; w webapps katalog o innej nazwie i
kopiujemy do niego
ca³¹ zawartoœæ katalogu MojaAp - nazwa nowoutworzonego katalogu
poprzedzona
ukoœnikiem).</li> <li><b>spakowanie</b> tej struktury do archiwum o
nazwie, maj¹cej rozszerzenie <b>WAR</b> (od Web Application Archive) i
skopiowaniu tego WAR-a do katalogu <b>webapps - </b>œcie¿k¹ kontekstu
dla schematu z rysunku bêdzie /MojaAp,</li> <li>utworzenie <b>deskryptora
kontekstu</b> aplikacji, w którym m.in podajemy
odwzorowanie pomiêdzy œcie¿k¹ kontekstu a katalogiem aplikacji;
deskryptor
ten mo¿na wpisac do pliku konfiguracyjnego serwera conf/server.xml,
albo
stworzyæ go w odrêbnym pliku XML o nazwie kontekstu&nbsp; i&nbsp;
umieœciæ ten plik w
&nbsp;katalogu conf/Catalina/host - &nbsp;wtedy œcie¿ka kontekstu
bêdzie pobrana z deskryptora kontekstu.</li>
</ul>Na starcie Tomcat&nbsp; tworzy i uruchamia konteksty
aplikacji,&nbsp; zarejestrowanych w jeden z trzech w/w sposobów.<br>
<br>Jak ju¿ wspomniano, kluczow¹ rolê dla aplikacji WEB odgrywa
deskryptor wdro¿enia - plik web.xml.<br>
Jest to plik XML, którego elementy okreœlaj¹ wdro¿eniowe w³aœciwoœci
aplikacji.<br>
Nale¿¹ do nich:<br>
<br><ul> <li>definicje filtrów (dodatkowo przetwarzaj¹cych,
filtruj¹cyhc, zlecenia dla serwletów i ich odpowiedzi)</li> <li>definicje
s³uchaczy (obs³uguj¹cych zdarzenia zwi¹zane z kontekstem i sesj¹),</li>
<li>definicje serwletów (i ich parametrów inicjalnych) lub stron JSP
sk³adaj¹cych siê na aplikacjê oraz tzw. ich mapowanie,&nbsp; </li> <li>konfiguracja
sesji (czyli po³¹czenia lub takich sekwencji po³¹czeñ
u¿ykownika z aplikacj¹, które zachowuj¹ to¿samoœæ u¿ytkownika) </li> <li>parametry
kontekstu (dostêpne dla wszystkich komponentów aplikacji),</li> <li>mapowanie
typów MIME.</li> <li>strony powitalne, </li> <li>strony opisu b³êdów,</li>
<li>lokalizacj deskryptorów bibliotek znaczników JSP (plików *.TLD) </li>
<li>ograniczenia ze wzglêdu na bezpieczeñstwo.</li> <li>definicje
odniesieñ do zasobów (np. baz danych),</li>
</ul>W³aœciwoœci s¹ definiowane za pomoc¹ znaczników XML, okalaj¹cych
wartoœæ
w³aœciwoœci. Znaczniki (otwieraj¹cy i zamykaj¹cy) wraz z umieszczonym
pomiêdzy
nimi cia³em nazywane s¹ elementami. Elementy mog¹ byæ zagnie¿d¿one. Np.
nastêpuj¹cy
element XML:<br>
<br>&lt;session-config&gt; <br>
&nbsp;&nbsp;&nbsp; &lt;session-timeout&gt;30&lt;/session-timeout&gt; <br>
&lt;/session-config&gt; <br>
<br>okreœla konfiguracjê sesji i zawiera element session-timeout,
okreœlaj¹cy
ile czasu nieaktywne po³¹czenie ma zachowywaæ sesjê (tu 30
minut).&nbsp; <br>
<br>Jak ka¿dy plik XML - deskryptor wdro¿enia rozpoczynamy znacznikiem:<br>
<br><b>&lt;?xml version="1.0" encoding=<i>charset</i>?&gt;</b><br>
<br>gdzie jako charset podajemy konkretn¹ stronê kodowa.<br>
<br>Nastêpnie otwieramy g³ówny element znacznikiem &lt;web-app ....
&gt;,<br>
Dla wersji 2.4 Servlet API w otwieraj¹cym znaczniku &lt;web-app ...
&gt;
&nbsp; podajemy lokalizacjê definicji formatu i znaczenia elementów
deskryptora
- jak poni¿ej.<br>
W g³ównym elemencie umieszczone s¹ wszystkie inne elementy, opisuj¹ce
w³asciwoœci aplikacji.<br>
Wygl¹da to w nastêpuj¹cy sposób:<br>
<br><pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app version="2.4"
    xmlns="http://java.sun.com/xml/ns/j2ee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee web-app_2_4.xsd"&gt;
   ...
   ...  <i>inne elementy </i>
   ...
&lt;/web-app&gt;

</pre>Uwaga: obecnie dostêpna jest specyfikacja Servlet API 2.5, ale
nie wnosi ona zbyt wielu zmian i interesuj¹cych dodatków, mo¿emy wiêc
spokojnie pzostaæ przy 2.4.<br><br>Warto zauwa¿yæ, ¿e w niektórych
przypadkach &nbsp;np. prostych stron JSP deskryptor
wdro¿enia mo¿e zawieraæ tylko g³ówny element (web-app), bez elementów
zagnie¿d¿onych.<br>
Dobrym zwyczajem jest jednak dostarczenie wtedy przynajmniej
&nbsp;krótkiej opisowej nazwy aplikacji (znacznik <b>&lt;display_name&gt;</b>
). Bêdzie ona widoczna w narzêdziach zarz¹dzania aplikacjami na
serwerze,
dziêki temu bêdziemy siê mogli ³atwo przekonaæ czy aplikacja dzia³a, a
tak¿e&nbsp;
koñczyæ i wznawiaæ jej dzia³anie. <br>Mamy np. do dyspozycji managera
aplikacji Tomcata, który wygl¹da tak jak na rys.<br>
<br><img style="width: 715px; height: 608px;"
 src="images/AppManager.jpg" alt="r">
<br><br>
Podane œcie¿ki kontekstu jednoznacznie identyfikuj¹ aplikacjê,
&lt;display_name&gt; daje dodatkowa informacjê.
<br><br>
No dobrze, stworzyliœmy deskryptor, mamy wymagan¹ strukturê katalogow¹
aplikacji,
stosuj¹c jeden z trzech omawianych wczeœniej sposobów wdro¿yliœmy j¹ w
œrodowisku
serwera. Jak j¹ teraz wywo³aæ?<br>
<br>Aplikacja WEB jest wywo³ywana za pomoc¹ jednego ze zleceñ
(requests) HTTP
np. GET lub POST. Url, który poprzedza parametry lub strumieñ danych
zlecenia
ma formê:<br>
<br><div class="syntax"> Wywo³anie aplikacji WEB<br>
<b>http://<i>url_serwera</i>/<i>kontekst</i> [ / {&nbsp; <i>strona_jsp</i>
| &nbsp;<i>mapowanie_nazwy_serwletu</i> } ]</b><br>
<br>&nbsp;[...] oznaczaj¹ opcjonalnoœæ,&nbsp; { x | y } oznacza "jedno
z"<br>
Natomiast:<br>
<ul> <li><b><i>kontekst</i></b> - jest nazw¹ kontekstu aplikacji ( <i><b>/kontekst</b></i>
jest œcie¿k¹ kontekstu)</li> <li><i><b>strona_jsp</b></i> - plik
tekstowy w formacie HTML z elementami JSP (<i><b>nazwa.jsp</b></i>) </li>
<li><b><i>mapowanie_nazwy_serwletu</i></b> - ustalona w pliku
web.xml&nbsp;
nazwa lub szablon nazwy (stosuj¹cy tzw. "wildcards" i okreœlaj¹cy wiele
nazw
pasuj¹cych do szablonu) za pomoc¹ której (lub których) mo¿e byæ
wywo³any
serwlet &nbsp;</li>
</ul></div><br>
<br>Je¿eli w odwo³aniu podano tylko <b>http://<i>url_serwera</i>/<i>kontekst</i></b>,
to aplikacja zostanie uruchomiona w nastêpuj¹cych przypadkach:<br>
<ul> <li>gdy w g³ównym katalogu wdro¿onej aplikacji znajduje siê plik
index.jsp,
to zostanie on wywo³any (ale to zale¿y od serwera i jego ustawieñ),</li>
<li>gdy w pliku web.xml zdefiniowano listê plików powitalnych w
nastêpuj¹cej postaci</li>
</ul><pre>   &lt;welcome-file-list&gt;
     &lt;welcome-file&gt;<i><b>plik1</b></i>.jsp&lt;/welcome-file&gt;
     &lt;welcome-file&gt;<i><b>plik2</b></i>.jsp&lt;/welcome-file&gt;
     ...
   &lt;/welcome-file-list&gt;

</pre>
<blockquote>a w g³ównym katalogu aplikacji znajduj¹ siê któreœ z tych
plików,
to zostanie wywo³any pierwszy z listy, który jest w katalogu (jest to
równie¿
sposób na dostarczenie u¿ytkownikowi zwyk³ego pliku html, z którego
albo
mog¹ prowadziæ linki do róznych czêœci aplikacji, albo mo¿na dostarczyæ
form
logowania, albo mo¿e on informowaæ u¿ytkownika, ¿e zapomnia³ dodaæ do
adresu
zlecenia dodatkowej specyfikacji, np. zmapowanej nazwy serwletu i przez
to
nie mo¿e uruchomiæ aplikacji),<br> </blockquote> <ul> <li>&nbsp;gdy
mapowanie nazwy serwletu ma postaæ /*, oznaczaj¹c¹ dowoln¹ nazwê,
to zostanie wywo³any serwlet, którego nazwa zosta³a w pliku web.xml
przyporz¹dkowana
tej formie odwo³ania.</li> </ul>
Zobaczmy przyk³ady wywo³ania aplikacji WEB w&nbsp; œrodowisku Tomcat.
Domyœlna
instalacja&nbsp;udostêpnia serwer poprzez port 8080 lokalnego hosta: <b>http://localhost:8080</b>.<br>
WyobraŸmy sobie teraz nastêpuj¹ce przypadki:<br> <br>
A. Aplikacja, powiedzmy - "Sklep ogrodowy", napisana jako strona JSP
(plik
run.jsp), odwo³uj¹ca siê do klasy GardenShop.class (JavaBean) i maj¹ca
w
pliku web.xml jedynie element &lt;display-name&gt; zosta³a wdro¿ona
poprzez
umieszczenie jej w podkatologu gs katalogu webapps:<br> <br> <span
 style="font-weight: bold;">&lt;katalog_intalacyjny_Tomcata&gt;</span><br>
<b>&nbsp; &nbsp; &nbsp; webapps</b><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <b>gs</b><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <b>WEB-INF<br> </b>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <b>classes</b><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; GardenShop.class<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; web.xml<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;run.jsp<br> <br>
Mo¿emy j¹ wtedy wywo³aæ poprzez podanie w przegl¹darce URL-a:<br> <b><br>
http://localhost:8080/gs/run.jsp</b><br> <br>
B. Aplikacja napisana jako strona JSP (w pliku index.jsp), odwo³uj¹ca
siê do klasy GardenShop.class (JavaBean) i maj¹ca w
pliku web.xml jedynie element &lt;display-name&gt; zosta³a wdro¿ona
poprzez
umieszczenie jej w podkatalugu gs katalogu webapps:<br> <br> <span
 style="font-weight: bold;">&lt;katalog_intalacyjny_Tomcata&gt;</span><br>
<b>&nbsp; &nbsp; &nbsp; webapps</b><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <b>gs</b><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <b>WEB-INF<br></b>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <b>classes</b><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; GardenShop.class<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; web.xml<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;index.jsp<br> <br>
Mo¿emy j¹ wtedy wywo³aæ poprzez podanie w przegl¹darce URL-a:<br> <b><br>
http://localhost:8080/gs</b><br> <br>
C. Aplikacja napisana jako strona JSP (w pliku run.jsp), odwo³uj¹ca siê
do klasy GardenShop.class (JavaBean), maj¹ca plik web.xml w
nastêpujacej
postaci:<br> <pre>&lt;?xml version="1.0"?&gt;
&lt;web-app version="2.4"
     xmlns="http://java.sun.com/xml/ns/j2ee"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"&gt;

   &lt;display-name&gt;Sklep ogrodniczy&lt;/display-name&gt;

   &lt;welcome-file-list&gt;
     &lt;welcome-file&gt;run.jsp&lt;/welcome-file&gt;
   &lt;/welcome-file-list&gt;

&lt;/web-app&gt;
</pre>
zosta³a wdro¿ona poprzez
umieszczenie jej w podkatalugu gs katalogu webapps:<br> <br> <span
 style="font-weight: bold;">&lt;katalog_intalacyjny_Tomcata&gt;</span><br>
<b>&nbsp; &nbsp; &nbsp; webapps</b><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <b>gs</b><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <b>WEB-INF<br></b>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <b>classes</b><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; GardenShop.class<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;web.xml<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;run.jsp<br> <br>
Mo¿emy j¹ wtedy wywo³aæ poprzez podanie w przegl¹darce URL-a:<br> <b><br>
http://localhost:8080/gs</b><br> <br>
<br>D. Aplikacja "Sklep ogrodowy" zosta³a napisana jako serwlet
GardenShopServlet.class.
W pliku web.xml okreœlono, ¿e mapowanie nazwy tego serwletu - &nbsp;to
/run. Aplikacja
zosta³a wdro¿ona w nastêpuj¹cy sposób (uwaga nie ma tu ju¿ ¿adnych
plików
JSP):<br> <b><br></b><span style="font-weight: bold;">&lt;katalog_intalacyjny_Tomcata&gt;</span><br>
<b>&nbsp; &nbsp; &nbsp; webapps</b><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <b>gs</b><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <b>WEB-INF<br></b>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <b>classes</b><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; GardenShopServlet.class<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;web.xml<br> <br> <br>
Mo¿emy j¹ wtedy wywo³aæ poprzez podanie w przegl¹darce URL-a:<br> <b><br>
http://localhost:8080/gs</b>/<b>run</b><br> <br>
E. Aplikacja "Sklep ogrodowy" zosta³a napisana jako serwlet
GardenShopServlet.class.
W pliku web.xml okreœlono, ¿e mapowanie nazwy tego serwletu&nbsp; to
/*. Aplikacja
zosta³a wdro¿ona w nastêpuj¹cy sposób:<br> <b><br></b><span
 style="font-weight: bold;">&lt;katalog_intalacyjny_Tomcata&gt;</span><br>
<b>&nbsp; &nbsp; &nbsp; webapps</b><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <b>gs</b><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <b>WEB-INF<br></b>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <b>classes</b><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; GardenShopServlet.class<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;web.xml<br> <br> <br>
Mo¿emy j¹ wtedy wywo³aæ poprzez podanie w przegl¹darce dowolnych URLI o
postaci:<br> <b><br>
http://localhost:8080/gs</b>/*<br> <br>
czyli np.<br> <b>
http://localhost:8080/gs</b><br> <b>
http://localhost:8080/gs/run</b><br> <b>
http://localhost:8080/gs/star</b>t<br> <b>
http://localhost:8080/gs/prosze_kwiatki</b><br> <br> <br>
Proces wdra¿ania aplikacji nie jest prosty. &nbsp;Pocz¹tkuj¹cym wiele
problemów
sprawia zorientowanie siê w nowych pojêciach (np. co to jest ten
"kontekst"?),
g¹szczu katalogów, wymagañ co do struktur, nazw. Omawiamy wdra¿anie na
pocz¹tku,
bowiem bez tej wiedzy nie sposób naprawdê zrozumieæ dzia³ania aplikacji
WEB,
ani te¿ - tym bardziej æwiczyæ ich tworzenia. Nieco abstrakcyjny na
razie,
syntetyzuj¹cy opis powinien dawaæ ogóln¹, mo¿na by powiedzieæ,
strukturaln¹
orientacjê (wa¿niejsz¹, myœlê, dla zrozumienia ni¿ bardzo konkretne
instrukcje
"zrób to, potem to, potem to" - na jakichœ szczególnych przypadkach). <br>
<br> Ale oczywiœcie takie konkretne przyk³ady s¹ tak¿e niezbêdne dla
zrozumienia
tego materia³u. Zajmiemy siê wiec teraz budow¹ i wdro¿eniem dwóch
konkretnych
prostych serwletów. Ich rola polega g³ównie na pokazaniu w jaki sposób
tworzy
siê (najprostsze) deskryptory wdro¿enia (web.xml) dla serwletów,
sposobów
wdra¿ania aplikacji WEB i relacji pomiêdzy œcie¿k¹ kontekstu a fizyczn¹
lokalizacj¹
aplikacji na dysku.<br> <br><a name="WebApps1.4"></a><h2>4. Przyk³adowy serwlet i jego wdro¿enie</h2><br>
Przyk³adowa aplilkacja WEB bêdzie sk³adaæ siê z dwóch (niezwi¹zanych ze
sob¹)
serwletów. S¹ one nie tylko proste, ale w³aœciwie bezu¿yteczne. Ich
g³ównym
zadaniem jest szczegó³owe pokazanie sposobów wdro¿enia aplikacji,
sposobu
odwo³ywania siê z generowanych stron do zasobów aplikacji (takich jak
pliki
graficzne czy HTML), oraz zwi¹zków pomiedzy œcie¿k¹ kontekstu a
fizycznym
katalogiem aplikacji.<br>
<br>Pierwszy serwlet, po wywo³aniu z przegl¹darki klienta generuje
stronê HTML,
która zostaje zwrócona do przegladarki. T³o wygenerowanej strony bêdzie
plikiem
graficznym o nazwie os2.jpg (musimy go jakoœ umieœciæ w strukturze
katalogów
aplikacji i umieæ sie do niego odnieœæ z programu), na stronie bêdzie
te¿
odnoœnik prowadz¹cy do jakiegoœ pliku HTML (te¿ znajduj¹cego siê w
ramach
naszej aplikacji), o nazwie powiedzmy Bye.html.<br>
Serwlet zapiszemy w pliku Msg.java. Po kompilacji programu,
zdefiniowaniu
deskryptora wdro¿enia (web.xml) i przygotowaniu zasobów (grafiki, HTML)
powinniœmy
mieæ na dysku nastêpuj¹c¹ strukturê katalogow¹ (g³ówny katalog
aplikacji
nazwiemy serwlety1).<br> <br>
serwlety1<br>
&nbsp; &nbsp; WEB-INF<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;classes<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Msg.class<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;web.xml<br>
&nbsp; &nbsp; images &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&lt;---- pliki graficzne umieszczamy w podkatalogu<br>
&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; os2.jpg<br>
&nbsp; &nbsp; Bye.html<br>
&nbsp;<br>
No, ale najpierw musimy napisaæ serwlet. <br>
Ju¿ za chwilê, w dalszej czêœci wyk³adu, zajmiemy sie dok³adnie budow¹
i dzia³aniem serwletów; teraz dla zrozumienia dzia³ania przyk³adu
wystarczy
wiedzieæ, ¿e:<br> <ul>
<li>aby byæ serwletem HTTP, klasa musi odziedziczyæ klasê HTTPServlet,</li><li>przedefiniowana
metoda <span style="font-weight: bold; font-style: italic;">doGet(HTTPServletRequest
zlecenie, HTTPServletResponse odpowiedz)</span>
obs³uguje zlecania GET (czyli np. "id¹ce" z&nbsp; paska adresów
przegl¹darki),</li><li>odpowiedŸ generujemy w postaci strony HTML (lub
zwyklego tekstu), pisz¹c
go do strumienia zwi¹zanego z obiektem HTTPServletResponse; w
szczególnoœci mo¿emy
wykorzystaæ strumieñ PrintWriter.</li> </ul>
Oto kod.<br> <pre>import javax.servlet.*;
import javax.servlet.http.*;
import java.io.*;

public class Msg extends HttpServlet {

  // Pocz¹tek HTML i w³aœciwoœci &lt;body&gt; - t³o, kolor tekstu i linków
  private String prolog =
                 "&lt;html&gt;&lt;title&gt;Przyk³ad&lt;/title&gt;" +
                 "&lt;body background=\\"images/os2.jpg\\" text=\\"antiquewhite\\"" +
                 "link=\\"white\\" vlink=\\"white\\"&gt;";

  // Tagi zamykaj¹ce
  private String epilog = "&lt;/body&gt;&lt;/html&gt;";


  // Metoda obs³ugi zlecenia GET

  public void doGet(HttpServletRequest request,
                       HttpServletResponse response)
                 throws ServletException, IOException
  {
     // Mo¿emy w ten sposób ustaliæ typ treœci i stronê kodow¹
     // ³atwiej ni¿ przez generowanie metatagów HTML

     response.setContentType("text/html; charset=ISO-8859-2");

     // Strumieñ wyjœciowy, tu generowana treœæ strony HTML
     // PrintWriter umo¿liwia u¿ycie metod print i println

     PrintWriter out = response.getWriter();


     out.println(prolog);  // piszemy pocz¹tek html i tag &lt;body ... &gt;

     // Piszemy treœæ
     out.println("&lt;h1&gt;Dokument HTML&lt;br&gt;wygenerowany przez serwlet&lt;/h1&gt;");
     out.println("&lt;br&gt;&lt;br&gt;&lt;a href=\\"Bye.html\\"&gt;Po¿egnanie&lt;/a&gt;");

     // Znaczniki zamykaj¹ce
     out.println(epilog);
     out.close();
  }

}
</pre>
Wa¿ne jest w tym przyk³adzie, aby zauwa¿yæ sposób odwo³ania z
generowanej
strony do zasobów aplikacji (plików os2.jpg i &nbsp;Bye.html). Klasa
serwletu
znajduje siê w katalogu serwlety1/WEB-INF/classes. Odwo³ania do zasobów
s¹
jednak zrelacjonowane wobec&nbsp; g³ównego katalogu aplikacji. Zatem
odwo³anie
"images/os2.jpg" jest - gdy patrzymy na nasz¹ strukturê katalogow¹ -
&nbsp;odwo³aniem "serwlety1/images/os2.jpg", a
odwo³anie "Bye.html" znaczy "serwlety1/Bye.html".<br> <br>
Przed wdro¿eniem aplikacji musimy stworzyæ deskryptor wdro¿enia
(web.xml).
W przypadku serwletów podstawowe informacje, które trzeba podaæ to:<br>
<ul> <li>nazwa identyfikuj¹ca serwlet.</li> <li>nazwa klasy serwletu,</li>
<li>mapowanie nazwy sewrletu na nazwê, której u¿yje klient w
specyfikacji URL zlecenia GET.</li> </ul>
Mamy tu dwa odwzorowania: nazwy i klasy, nazwy i mapowania.<br>
Do zwi¹zania nazwy i klasy serwletu stosuje siê podelemnt
&lt;servlet_name&gt; elementu &lt;servlet&gt; np.<br> <pre>    &lt;servlet&gt;
       &lt;servlet-name&gt;HTMLMsg&lt;/servlet-name&gt;
       &lt;description&gt;Prosty napis&lt;/description&gt;
       &lt;servlet-class&gt;Msg&lt;/servlet-class&gt;
    &lt;/servlet&gt;
</pre>
Widzimy tu, ¿e:<br> <ul> <li>dla celów identyfikacyjnych nazwaliœmy
nasz serwlet HTMLMsg (inaczej ni¿ nazwa klasy),</li> <li>mo¿emy podaæ
(choæ niekoniecznie) krótki opis serwletu w &nbsp;znacznikach
&lt;description&gt;</li> <li>nazwê klasy serwletu podajemy w
znacznikach &lt;servlet-class&gt;;
nasza klasa Msg, zawarta w pliku Msg.java zosta³a skompilowana do pliku
Msg.class
- podaliœmy zatem nazwê klasy Msg</li> <li>i - uwaga - gdy serwlet
jest w nazwanym pakiecie (a zatem i w podkatalogu
katalogu classes) podajemy te¿ nazwê pakietu np. controller.Msg</li> </ul>
Mapowanie uzyskujemy dziêki elementowi &lt;servlet_mapping&gt;<br> <pre>    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;HTMLMsg&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/msg&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
</pre>
Przy tym:<br> <ul> <li>element <b>servlet </b>musi poprzedzaæ
element <b>servlet-mapping</b>,</li> <li>dla danego serwletu
&nbsp;jego nazwy w tagu &lt;servlet-name&gt; w obu elmentach musz¹ byc
takie same,</li> <li>element <b>url-pattern</b> okreœla sposób
odwo³ania do tego serwletu
(byæ mo¿e jednego z wielu w ramach aplikacji); u¿ywaj¹c przy tym
gwiazdek
mo¿emy dostarczyæ wielu sposobów wywo³ania serwletu (np. podanie&nbsp;
/*.html
bêdzie powodowaæ wywo³anie serwletu w sytuacji gdy u¿ytkownik wprowadzi
dowoln¹
nazwê, zakoñczon¹ .html</li> </ul>
<br>Ca³y plik deskryptora wdro¿enia (web.xml) dla naszej aplikacji (na
razie zawieraj¹cej tylko jeden serwlet) wygl¹da tak:<br> <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app version="2.4"
         xmlns="http://java.sun.com/xml/ns/j2ee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"&gt;

    &lt;display-name&gt;Serwlety 1&lt;/display-name&gt;
    &lt;description&gt;Proste przykladowe serwlety&lt;/description&gt;

    &lt;servlet&gt;
       &lt;servlet-name&gt;HTMLMsg&lt;/servlet-name&gt;
       &lt;description&gt;Prosty serwlet&lt;/description&gt;
       &lt;servlet-class&gt;Msg&lt;/servlet-class&gt;
    &lt;/servlet&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;HTMLMsg&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/msg&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

&lt;/web-app&gt;
</pre>
<br>Pozostaje nam teraz wdro¿enie.<br> <br>
Za³ó¿my,&nbsp; ¿e g³ówny katalog naszej aplikacji znajduje siê w
katalogu G:\Programy\serwlety1.<br> <br>
Jak ju¿ mówiliœmy, dla wdro¿enia wystarczy go skopiowaæ do
katalogu&nbsp;&lt;katalog_intalacyjny_Tomcata&gt;\webapps uzyskuj¹c:<br>
<br><span style="font-weight: bold;">&lt;katalog_intalacyjny_Tomcata&gt;</span><br>
&nbsp; &nbsp; &nbsp;webapps<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .....<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; serwlety1<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ....<br> <br>
Mo¿emy te¿ spakowaæ go jarem do pliku o rozszerzeniu WAR i to archiwum
przekopiowaæ do katalogu webapps.<br> <br><br>
Uruchomienie naszego serwletu (zgodnie z ogóln¹ regu³¹ podan¹
wczeœniej) uzyskamy przez:<br> <br> <img src="images/InvokeServl.jpg"
 alt="r" border="1" height="149" width="471"> <br> <br>
Uruchomienie i dzialanie serwletu ilustruj¹ poni¿sze rysunki.<br> <br>
<br>
Otwieramy przegl¹darkê i poprzez wpisaniu na pasku adresu odwo³ania do
serwletu - przesy³amy mu
zlecenie GET, otrzymuj¹c w odpowiedzi wygenerowan¹ stronê:<br><br> <img
 style="border: 1px solid ; width: 601px; height: 408px;"
 src="images/MsgStart2.jpg" alt="r"> <br> <br>
<br><a name="WebApps1.5"></a><h2>5. Deskryptor kontekstu. Dostêp do zasobów aplikacji</h2>Trzeci
sposób wdro¿enia - za pomoc¹ <b>deskryptora kontekstu</b> - ma pewne
zalety wobec omówionych:<br> <ul> <li>nie wymaga kopiowania katalogów
lub WARów,</li> <li>mo¿na za jego pomoc¹ ustaliæ dowoln¹ (ale
jednoznaczn¹) nazwê kontekstu
i zwi¹zaæ j¹ z dowolnym fizycznym katalogiem, w którym rezyduje nasza
apliakacja/<br></li> </ul>
Deskryptor kontekstu jest elementem XML o nazwie <b>Context</b>, w
którym
opisujemy kontekst aplikacji. Mo¿emy wpisaæ ten deskryptor do pliku
konfiguracyjnego
serwera (conf/server.xml) pod elementem Host. Lepiej jednak (i
bezpieczniej
ze wzglêdu na mo¿liwoœæ przypadkowych modyfikacji pliku konfiguarcji
serwera)&nbsp;
jest wpisac deskryptor kontekstu do pliku XML o&nbsp;nazwie takiej jak
kontekst aplikacji i umieœciæ
ten plik w katalogu conf/Ctalina/nazwa_hosta (np.
conf/Catalina/localhost. To wystarczy dla wdro¿enia aplikacji&nbsp;.<br>
<br>
Element <b>Context</b> mo¿e zawieraæ szereg podelementów, m.in. takie,
które
znajduj¹ siê równie¿ w pliku web.xml. Mo¿na te¿ w nim definiowaæ nazwy
plików
logów dla aplikacji (do których to plików bêd¹ zapisywane ró¿ne
informacje&nbsp;
np. o b³êdach, ostrze¿eniach, ale równie¿ dowolna treœæ - np. za pomoc¹
metody
log(..) z klas serwletowych). Bardzo wa¿nym zastosowaniem deskryptora
kontekstu
jest ustanawianie powi¹zañ z zasobami zewnêtrznymi i podawanie
parametrów
potrzebnych, by do takich zasobów (np. baz danych) móc siê odwo³ywaæ.<br>
<br>
W tej chwili interesuj¹ nas jednak przede wszystkim te w³aœciwoœci
deskryptora
kontekstu, które pozwalaj¹ wdro¿yæ aplikacjê bez umieszczania jej
struktury
katalogowej (spakowanej lub nie) pod webapps. W tym wzglêdzie
deskryptor kontekstu wygl¹da niezwykle
prosto:<br> <br>
<div class="syntax"> Najprostsza forma deskryptora kontekstu<br> <b>&lt;Context
<br>&nbsp; &nbsp; &nbsp; docBase="<i>œcie¿ka_do_katalogu_aplikacji</i>"<br>
&lt;/Context&gt;<br> <br> </b>gdzie: <br><ul> <li><i><b>œcie¿ka_do_katalogu_aplikacji</b></i>
&nbsp;- lokalizacja katalogu
aplikacji lub pliku WAR w systemie plikowym; œcie¿kê mo¿emy podac w
postaci
absolutnej np. C:/przyklady/MojaAp, albo <b>relatywnie</b> w stosunku
do tzw. "bazy aplikacji" hosta (standardowo katalogu&nbsp;<span
 style="font-weight: bold;">&lt;katalog_intalacyjny_Tomcata&gt;</span><b>/webapps</b>).</li>
</ul>
</div><br> Zobaczmy to na przyk³adzie naszej aplikacji (zawieraj¹cej na
razie jeden serwlet - Msg.java).<br>
Jak pamiêtamy, jej komponenty znajdow¹³y siê w katalogu
G:/Programy/serwlety1.<br>
Za³ó¿my, ¿e Tomcat jest zainstalowane w katalogu
E:/Serwery/apache-tomcat-6.0.13. Przy wdro¿eniu skopiowaliœmy
katalog serwlety1 z G:/Programy do
&nbsp;E:/Serwery/apache-tomcat-6.0.13/webapps. Œcie¿k¹ kontekstu
aplikacji
by³a /serwlety1 i za jej pomoc¹ uruchamialiœmy tê aplikacjê.<br> <br>
Teraz wdro¿ymy tê sam¹ aplikacjê pod jeszcze dwoma ró¿nymi kontekstami.<br>
Skopiujemy najpierw jej komponenty do katalogu E:/WebAplikacja1
(oczywiœcie
struktura katalogowa jest zachowana, z tym, ¿e teraz g³ównym katalogiem
aplikacji
jest F:/WebAplikacja1).<br> <br>
Przygotujmy dwa deskryptory kontekstu. Pierwszy wprowadzi kontekst o
nazwie
Show zwi¹zany z aplikacj¹ umieszczon¹ w katalogu G:/Programy/serwlety1,
drugi
- kontekst o nazwie wa1 zwi¹zany z aplikacj¹ z katalogu
E:/WebAplikacja1.
Umieœcimy je w plikach XML o nazwach Show.xml wa1.xml&nbsp; np.<br> <br>
Show.xml<br> <pre>&lt;Context docBase="G:/Programy/serwlety1/build"&gt;
&lt;/Context&gt;

</pre>
wa1.xml<br> <pre>&lt;Context  docBase="../../WebAplikacja1"&gt;
&lt;/Context&gt;
</pre>
Tu zwrócmy uwagê na relatywn¹ œcie¿kê (zaczynamy z&nbsp; katalogu
aplikacji&nbsp;&nbsp;E:/Tomcat/webapps, .. /.. przenosi nas do katalogu
E:/ i st¹d wskazujemy
katalog WebAplikacja1.<br> <br>
Po skopiowaniu tych plików XML&nbsp; do katalogu
conf/Catalina/localhost&nbsp; uzyskamy dostêp do trzech aplikacji
(które robi¹ to samo, bo zosta³y skopiowane)
pod kontekstami:<br>
/serwlety1 &nbsp; (to jest nasze pocz¹tkowe wdro¿enie)<br>
/Show &nbsp; &nbsp; &nbsp; &nbsp; (to zapewni³ plik Show.xml i zwarty w
nim deskryptor kontekstu)<br>
/wa1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (to za spraw¹ deskryptora
kontekstu z pliku wa1.xml<br> <br>
Ka¿de z wywo³añ <br>
http://localhost:8080/wa1/msg, <br>
http://localhost:8080/Show/msg<br> http://localhost:8080/serwlety1/msg<br>
<br>
poka¿e nam znany ju¿ obrazek pochodz¹dzy z serwletu Msg.java.<br> <br>
Mo¿emy siê te¿ przekonaæ ³atwo, ¿e rzeczywiœcie&nbsp;konteksty odnosz¹
siê do konkretnych&nbsp;fizycznych katalogów.<br> <br>
W tym celu dodamy do naszej aplikacji serwlet Msg2.java, który bêdzie
pokazywa³
ró¿ne informacje, m.in. o œcie¿kach. Przy okazji zilustruje on niektóre
metody
klasy HTTPServlet, HTTPServletRequest oraz interfejsu ServletContext
(który
"opisuje" kontekst aplikacji w ramach której dzia³a serwlet)..<br>
Od obiektu reprezenetuj¹cego zlecenie (HTTPServletRequest) mo¿emy
dowiedzieæ siê m.in.<br> <ul> <li>jaki jest URL zlecenia (metoda
getRequestURL()),</li> <li>jaka jest œcie¿ka kontekstu - metoda
getContextPath(),</li> <li>jaka jest œcie¿ka uruchamiaj¹ca serwlet,
który po raz pierwszy otrzyma³ to zlecenie - metoda getServletPath().</li>
</ul>
Od samego serwletu mo¿emy pobraæ jego kontekst (typ ServletContext) za
pomoc¹ metody getServletContext().<br>
Z kolei od kontekstu mo¿emy dowiedzieæ siê wielu ciekawych rzeczy,
m.in.:<br> <ul> <li>informacji o serwerze (getServerInfo()),</li> <li>nazwy
aplilkacji podanej w omawianiym wczeœniej tagu &lt;display-name&gt;
pliku web.xml - metoda getServletContextName(),</li> <li>jaka jest
prawdziwa (np. po czêœci fizyczna w systemie plikowym hosta)
œcie¿ka dla podanej œcie¿ki "wirtualnej" (takiej jak np. /serwlety1) -
metoda
getRealPath(String),</li> <li>jakie komponenty (i zasoby) sk³adaj¹ siê
na aplikacje (metoda&nbsp; getResourcePaths(String))</li> </ul> <br>
Zobaczmy kod nowego serwletu (warto zwróciæ uwagê, ¿e w zwracanej
odpowiedzi
nie stosujemy ¿adnych konstrukcji HTML - przegl¹darka uzyska i poka¿e
czysty
tekst).<br> <pre>import javax.servlet.*;
import javax.servlet.http.*;
import java.io.*;
import java.util.*;
import java.net.*;

public class Msg2 extends HttpServlet {

  private ServletContext context;
  private PrintWriter out;

  public void doGet(HttpServletRequest req, HttpServletResponse resp)
                       throws ServletException, IOException
  {
    out = resp.getWriter();
    out.println("To jest strona wygenerowana przez serwlet " +
                 this.getClass().getName()+ ".class");
    out.println("-------------------------------------------------------");

    // Jak wygladal URL z ktorego przyszlo zlecenie
    String requestURL = req.getRequestURL().toString();
    out.println("RequestURL: " + requestURL);

    // Uzyskujemy kontekst
    context = this.getServletContext();

    // Mo¿emy od niego pobraæ informacje o serwerze
    out.println("\\nServer info\\n" + context.getServerInfo() );

    // Mo¿emy dowiedzieæ siê jaka jest nazwa aplikacji
    // okreœlona w &lt;display-name&gt;
    out.println("\\nAplikacja ma nazwe: " + context.getServletContextName() );

    // Informacje o œcie¿kach
    String contextPath = req.getContextPath();
    String servletPath = req.getServletPath();

    // Od kontekstu mo¿emy dowiedzieæ siê te¿ jakie s¹ fizyczne œcie¿ki
    // prowadzace do "wirtualnych" URLI
    out.println("\\nInformacja o sciezkach");
    msg("ContextPath", contextPath);
    msg("ServletPath", servletPath);

    // I nasze pliki "zasobowe" (HTML, JPG)
    msg("Plik Bye.html", "Bye.html");
    msg("Plik os2.jpg", "images/os2.jpg");

    // Lista zasobów aplikacji
    out.println("\\nLista zasobow aplikacji");
    listResources("/");

    // Mo¿emy na tych zasobach wykonywaæ op we-wy
    InputStream in = context.getResourceAsStream("/WEB-INF/web.xml");
    BufferedReader br = new BufferedReader( new InputStreamReader(in));
    out.println("\\nPierwszy wiersz pliku web.xml");
    out.println(br.readLine());
    br.close();

    // W jakim katalogu dzia³a serwlet?
    File dir = new File(".");
    out.println("\\nA serwlet dzialal w katalogu: " + dir.getAbsolutePath());


    out.close();
  }

   // Listuje zasoby aplikacji
  private void listResources(String path)  {
    if (path == null) return;
    Set res = context.getResourcePaths(path);
    for (Iterator iter = res.iterator(); iter.hasNext(); ) {
      String resItem = (String) iter.next();
      if (resItem.endsWith("/")) listResources(resItem);
      else out.println(resItem);
    }
  }

  private void msg(String info, String path) {
    out.println("------------------------------------------");
    out.println(info);
    String realPath = context.getRealPath(path);
    out.println("Virtual: " + path);
    out.println("Real   : " + realPath);
  }

}
</pre>
<br>Niew¹tpliwie ciekawa jest tu metoda getResources() i jej
rekurencyjne wykorzystanie
we w³asnej metodzie listResources(). Za chwilê - po obejrzeniu wyników
dzialania
serwletu - powiemy o niej wiêcej. Przedtem jednak musimy nowy serwlet
umiejscowiæ
w strukturze naszej aplikacji. <br>
W tym celu - po skompilowaniu serwletu do katalogu classes - musimy
uzupelniæ
deskryptor wdro¿enia. Teraz aplikacja sk³ada siê z dwóch serwletów,
zatem
opis nowego serwletu musi znaleŸæ siê w pliku web.xml. Ustalimy przy
tym,
¿e do serwletu Msg2.java bêdzie mo¿na siê odwo³aæ podaj¹c po œcie¿ce
kontekstu
mapowanie /paths.<br>
Nowy plik web.xml wygl¹da tak:<br> <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app version="2.4"
         xmlns="http://java.sun.com/xml/ns/j2ee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"&gt;

    &lt;display-name&gt;Serwlety 1&lt;/display-name&gt;
    &lt;description&gt;Proste przykladowe serwlety&lt;/description&gt;

    &lt;servlet&gt;
       &lt;servlet-name&gt;HTMLMsg&lt;/servlet-name&gt;
       &lt;description&gt;Prosty serwlet&lt;/description&gt;
       &lt;servlet-class&gt;Msg&lt;/servlet-class&gt;
    &lt;/servlet&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;HTMLMsg&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/msg&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

    &lt;servlet&gt;
       &lt;servlet-name&gt;Msg2&lt;/servlet-name&gt;
       &lt;description&gt;Info o sciezkach&lt;/description&gt;
       &lt;servlet-class&gt;Msg2&lt;/servlet-class&gt;
    &lt;/servlet&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;Msg2&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/paths&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

&lt;/web-app&lt;
</pre>
a struktura naszej aplikacji jest teraz taka:<br> <br>
&lt;g³ówny_katalog_aplikacji&gt;<br>
&nbsp; &nbsp; WEB-INF<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;classes<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Msg.class<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Msg2.class <br>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// ... ew. inne klasy<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;web.xml &nbsp; &nbsp; &nbsp;&nbsp;
&lt;--- zawiera opis obu serwletów<br>
&nbsp; &nbsp; images &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&lt;---- pliki graficzne umieszczamy w podkatalogu<br>
&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; os2.jpg &nbsp; &nbsp; &nbsp;
&nbsp; &lt;--- to jest t³o strony generowanej przez serwlet Msg<br>
&nbsp; &nbsp; Bye.html &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;---
a to strona do której prowadzi link z HTML-u z Msg<br> <br> <br>
Po wdro¿eniu w kontekœcie /Show (np. za pomoca poprzednio pokazanego
sposoby z deskryptorem kontekstu)&nbsp; bêdziemy ten serwlet uruchamiaæ
poprzez <br><br>
http://localhost:8080/Show/paths<br> <br>
i uzyskamy w przegl¹darce nastepuj¹ce wyniki:<br><br><br><div
 class="notec"><pre>To jest strona wygenerowana przez serwlet Msg2.class
-------------------------------------------------------
RequestURL: http://localhost:8080/Show/paths

Server info
Apache Tomcat/6.0.18

Aplikacja ma nazwe: Przykladowe Serwlety 1

Informacja o sciezkach
------------------------------------------
ContextPath
Virtual: /Show
Real   : E:\\Programming\\webapsNew\\SERWLETY\\serwlety1\\build\\Show
------------------------------------------
ServletPath
Virtual: /paths
Real   : E:\\Programming\\webapsNew\\SERWLETY\\serwlety1\\build\\paths
------------------------------------------
Plik Bye.html
Virtual: Bye.html
Real   : E:\\Programming\\webapsNew\\SERWLETY\\serwlety1\\build\\Bye.html
------------------------------------------
Plik os2.jpg
Virtual: images/os2.jpg
Real   : E:\\Programming\\webapsNew\\SERWLETY\\serwlety1\\build\\images\\os2.jpg

Lista zasobow aplikacji
/Bye.html
/images/os2.jpg
/WEB-INF/lib/standard.jar
/WEB-INF/lib/jstl.jar
/WEB-INF/classes/Msg.class
/WEB-INF/classes/Msg2.class
/WEB-INF/web.xml


Pierwszy wiersz pliku web.xml
&lt;?xml version="1.0" encoding="UTF-8"?&gt;

A serwlet dzialal w katalogu: E:\\Serwery\\Apache_Tomcat_ 6.0.18\\bin\\.
</pre></div>
<br>Zwróæmy
uwagê na pokazane fizyczne œcie¿ki.<br>
No i na ciekaw¹ metodê gerResources(), która umo¿liwia dostep do
zasobów aplikacji
z serwletu. Dzia³a ona podobnie do listowania katalogu - zwraca zbiór
œcie¿ek,
które znajduj¹ siê "pod" podan¹ jako argument œcie¿k¹. Podaj¹c jako
argument
"/" odwo³ujemy siê do g³ównej œcie¿ki aplikacji (inaczej zwanej <b>context
root</b>
) i uzyskujemy wszystko co pod ni¹ sie znajduje. W naszym przypadku
getResources("/")
zwróci: &nbsp;zbiór elementów "/images/", "/WEB-INF/", "/Bye.html".
Elementy, które
mo¿na dalej rozwijaæ (stanowi¹ce podkatalogi) koñcz¹ siê ukoœnikiem.
Wszystkie
elementy maj¹ na pocz¹tku ukoœnik (np. plik Bye.html - jest
przedstawiony
jako "/Bye.html").<br> <br>
Na zasobach aplikacji mo¿emy wykonywaæ operacje wejœcia-wyjœcia
&nbsp;poprzez
uzyskanie strumienia zwi¹zanego z zasobem za pomoc¹ metody
getResourceAsStream(String
sciezkaZasobu). Pokazuje to przyk³ad czytania pliku web.xml, a
podkreœlmy
¿e ten sposób dzia³ania jest wygodny, bowiem - jak widaæ - roboczym
katalogiem
serwletu nie jest katalog naszej aplikacji, ale katalog serwera.<br> <br><hr
 style="width: 100%; height: 2px;"><a name="WebApps.3"></a><a name="WebApps1.6"></a><h2>6.
Budowanie, rozwijanie i wdra¿anie aplikacji za pomoc¹ Ant-a.
</h2>Jak widaæ proces rozwijania aplikacji WEB jest doœæ pracoch³onny,
¿eby nie
powiedzieæ uci¹¿liwy. Samo ostateczne wdro¿enie (wymagaj¹ce rozlicznych
zabiegów
konfiguracyjnych) - jako jednorazowe, przynajmniej na jakiœ czas - nie
straszy
tak bardzo nak³adami pracy. Gorzej z kolejnymi fazami rozwijania i
testowania
aplikacji. Je¿eli za ka¿dym razem, przy ka¿dej zmianie w procesie
rozwoju
programu, nawet w najprostszym przypadku musimy wykonaæ wszystkie
opisane
wczeœniej czynnoœci "rêcznie", to staje siê to bardzo uci¹¿liwe, a co
gorsza
skupia uwage na arbitralnych, konwencjonalnych szczególach technicznych
(a
jak <b>musi</b> siê nazywaæ katalog, a jaka <b>musi</b> byæ jego
struktura, a jakie <b>musz¹</b> byæ elementy w pliku web.xml itp.),
nie maj¹cych nic wspólnego z logik¹ aplikacji i sfer¹ rozwi¹zywanego
przez ni¹ problemu.<br> <br>
Oczywiœcie - ze wzglêdu na naturê aplikacji WEB jest to nie do
unikniêcia.
Mo¿na jednak unikn¹æ ca³kowicie "rêcznego" powtarzania niezbêdnych
rutynowych
czynnoœci.<br> Istniej¹ œrodowiska wizualnego programowania, które
u³atwiaj¹
te wszystkie sprawy (np. NetBeans, Eclipse). O tym za chwilê.<br><br>
Teraz powiemy parê s³ów o innej, uniwersalnej, mo¿liwoœci automatyzacji
rutynowych
czynnoœci zwi¹zanych z rozwijaniem i wdra¿aniem aplikacji WEB -
narzêdziu,
które nazywa siê Ant.<br> <br>
Ant pozwala zapisaæ sekwencjê wspólzale¿nych dzia³añ (zadañ), które
nastêpnie wykonuje, co prowadzi
w efekcie do instalacji lub wdro¿enia aplikacji. Obejmuj¹ one m.in.:<br>
<ul> <li>tworzenie niezbêdnych katalogów,</li> <li>kompilacjê kodów
Ÿród³owych,</li> <li>kopiowanie plików do odpowiedniej struktury
katalogowej,</li> <li>instalacjê lub wdro¿enie aplikacji za pomoc¹
specyficznych zadañ, kierowanyh do managera aplikacji Tomacta.</li> </ul>
Sekwencje tych zadañ zapisujemy w specjalnym pliku XML, interpretowanym
przez Ant, który wykonuje opisane czynnoœci. Przy tym mo¿emy u¿ywaæ
zmiennych i w ten sposób "parametryzowaæ"
dzia³anie Anta (w ³atwy sposób, w jednym miejscu, zmieniaæ nazwy
aplikacji, umiejscowienie jej
struktur katalogowej itp.).<br> <br> Nie sposób w kilku s³owach opisaæ
Anta (na ten temat s¹ ponad 500-stronicowe
ksi¹¿ki, np. œwietna "Java Development with Ant" Ericka Hatchera i
Steve'a
Looghrana). <br> <br>
Przedstawimy raczej "techniczn¹" instrukcjê, dotycz¹c¹ ³atwego sposobu
budowania
i instalowania aplikacji WEB za pomoc¹ Anta,<br> <br>
Po pierwsze, musimy stworzyæ okreslon¹ strukturê katalogow¹ rozwijanej
apliakcji.<br>
Najwygodniej zrobiæ to w nastêpuj¹cej formie:<br> <br> <ul> <li>&lt;katalog_aplikacji&gt;</li>
<ul> <li>&nbsp; &nbsp; &nbsp;src &nbsp; &nbsp; &nbsp;&lt;---
podkatalog z kodami ¿ród³owymi</li> <li>&nbsp; &nbsp; &nbsp;web &nbsp;
&nbsp;&lt;--- podkatalog z komponentami WEB (np. strony powitalne itp,
opisy znaczników.)</li> <ul> <li>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;WEB-INF &nbsp;&lt;--- w tym podkatalogi
umieœcimy deskryptor &nbsp;wdro¿enia web.xml&nbsp;&nbsp;</li> </ul> </ul>
<li>build.xml &nbsp; &nbsp; &lt;--- to bêdzie zapis dzia³añ dla Anta</li><li>build.properties
&lt;--- ew. definicje ró¿nych w³asciwoœci danej aplikacji<br> </li> <li>context.xml
&nbsp;&lt;--- opcjonalny plik deskryptora kontekstu aplikacji. <br> </li>
</ul>
&nbsp;<br>
Ant wykonuje swoje zadania tylko wtedy gdy istnieje taka potrzeba (np.
kompilacja
jest wykonywana tylko jeœli ¿ród³a maj¹ nowsz¹ datê od dotychczasowych
wyników kompilacji,
pliki s¹ kopiowane tylko wtedy, gdy s¹ nowsze od ju¿ obecnych),
Rozpoczynaj¹c
opis zadañ anta (ich wykonanie umieszczamy w tagu target) poprosimy o
ustalenie
bie¿¹cego czasu (tstamp):<br> <pre>&lt;project name="nazwa projektu" default="build" basedir="."&gt;
  &lt;target name="init"&gt;
      &lt;tstamp/&gt;
  &lt;/target&gt;

</pre>
Uwagi:<br> <ul> <li><b>default</b> - oznacza domyœlne zadanie, gdy
anta wywo³amy bez argumentów (jako argument mo¿emy podaæ zadanie do
wykonania),</li> <li><b>basedir</b> - oznacza katalog (tu bie¿¹cy)
wobec którego "rozwi¹zywane" s¹ relatywne odniesienia do katalogów i
plików</li> </ul>
Nastêpnie musimy ustaliæ specyficzne dla aplikacji w³aœciwoœci: katalog
w
którym maj¹ byæ umieszczone&nbsp; elementy aplikacja gotowe do
zainstalowania
lub wdro¿euia, nazwê kontekstu apliakcji.<br> <br>
Specyficzne w³aœciwoœci naszej apliakcji zapiszemy w pliku
build.properties, np:<br> <pre>app=serwlety1
app.path=E:/webaps/SERWLETY
</pre>
i u¿yjemy ich w pliku ant-a build.xml jako wartoœci zmiennych
(oznaczanych przez ${nazwa_zmiennej}:<br> <pre>  &lt;property file="build.properties"/&gt;
  &lt;property name="build" value="\${app.path}/\${app}/build" /&gt;
  &lt;property name="context.path" value="\${app}" /&gt;
</pre>
Powy¿ej, uzyskaliœmy wartoœci z pliku build.properties, po czym
u¿yliœmy
ich do ustalenia w³aœciwoœci build i context.path. Od tego momentu,
zmienna
${build} ma wartoœæ<br>
e:/webaps/SERWLETY/serwlety1/build (to jest ten katalog, w którym
umieszczone
zostan¹ gotowe do wdro¿enia czy instalacji komponenty), a zmienna
${context.path}
&nbsp;oznaczaj¹ca kontekst aplikacji ma wartoœæ serwlety1.<br> <br>
Zadanie przygotowawcze polega na stworzeniu odpowiednich katalogów
(jeœli jest taka potrzeba, jesli ich jeszcze nie ma).<br> <pre>  &lt;target name="prepare" depends="init"
   	description="Buduje katalogi build"&gt;
    &lt;mkdir dir="\${build}" /&gt;
    &lt;mkdir dir="\${build}/WEB-INF" /&gt;
    &lt;mkdir dir="\${build}/WEB-INF/classes" /&gt;
    &lt;mkdir dir="\${build}/WEB-INF/lib" /&gt;	
    &lt;mkdir dir="\${build}/WEB-INF/tags" /&gt;			
  &lt;/target&gt;

</pre>
Uwagi:<br> <ul> <li>za pomoca <b>depends</b> ustalamy zale¿noœæ
zadañ. Zadanie <b>prepare</b> bêdzie
wykonane tylko wtedy gdy zadanie init zakoñczy³o siê poprawnie,</li> <li>katalog
tags jest przeznaczony na w³asne biblioteki znaczników JSP,
nie zawsze musi byæ potrzebny, tak samo jak lib (ogolne biblioteki klas
dla
ca³ej apliakcji), ale tworzymy tu ogóln¹, przygotowan¹ na wszystkie
przypadki
programowania serwletów i JSP strukturê katalogow¹.</li> </ul>
Podstawowe zadanie <b>build</b> polega na kompilacji klas i kopiowaniu
komponentów do katalogu instalacyjnego (oznaczanego przez zmienn¹
${build}).<br>Wczeœniej powinniœmy ustaliæ œcie¿k¹ classpath, na której
znajd¹ siê niezbêdne w kompilacji pakiety (pliki JAR).<br> <pre>   &lt;!-- Sciezka klas dla kompilacji --&gt;

  &lt;path id="classpath"&gt;
    &lt;fileset dir="\${catalina.home}/lib"&gt;
      &lt;include name="*.jar"/&gt;
    &lt;/fileset&gt;
  &lt;/path&gt;

</pre>
Uwaga:<br> <ul> <li>wygodn¹ intsrukcj¹ Anta jest <b>fileset</b>
- definiowanie zbiorów plików.
Tutaj mówimy, ¿e pod identyfikatorem classpath ma siê znaleŸæ zbiór
wszystkich
plików z rozszerzeniem jar z katalogu&nbsp;/lib katalogu instalacyjnego
Tomcata (podanego w pliku properties pod nazw¹ catalina.home); u¿ycie
&nbsp;include **/*.ext w³¹czy³oby do zbioru wszystkie pliki z
rozszerzeniem
ext z katalogu dir i ca³ego drzewa podkatalogów (rekursywnie)
zaczynaj¹cych
siê w katalogu dir.</li> </ul> <br>
Do tej œcie¿ki (identyfikowanej przez classpath) odwo³amy siê w zadaniu
kompilacji (j<b>avac</b>), stanowi¹cego czeœc zadania build. Inne
fragmenty tego zadania polegaj¹ na kopiowaniu plikó.<br> <br> <pre>  &lt;target name="build" depends="prepare"
     description="Kompilacja i kopiowanie" &gt;
    &lt;javac srcdir="src" destdir="\${build}/WEB-INF/classes" debug="on"&gt;
    	&lt;include name="**/*.java" /&gt;
     	&lt;classpath refid="classpath"/&gt;
    &lt;/javac&gt;
    &lt;copy todir="\${build}/WEB-INF"&gt;
      &lt;fileset dir="web/WEB-INF"    &gt;
        &lt;include name="**/*.xml" /&gt;
        &lt;include name="**/*.html" /&gt;
        &lt;include name="**/*.tld" /&gt;
        &lt;include name="**/*.properties" /&gt;
        &lt;include name="**/*.txt" /&gt;
      &lt;/fileset&gt;
    &lt;/copy&gt;
    &lt;copy todir="\${build}"&gt;
      &lt;fileset dir="web"&gt;
        &lt;include name="**/*.html" /&gt;
        &lt;include name="**/*.jsp" /&gt;
        &lt;include name="**/*.jspf" /&gt;
        &lt;include name="**/*.gif" /&gt;
      &lt;/fileset&gt;
    &lt;/copy&gt;
    &lt;copy todir="\${build}/WEB-INF/tags"&gt;
      &lt;fileset dir="web"&gt;
        &lt;include name="**/*.tag" /&gt;
      &lt;/fileset&gt;
    &lt;/copy&gt;
  &lt;/target&gt;

</pre>
Kompilowane i kopiowane s¹ tylko te pliki, które zosta³y zmodyfikowane.<br>
Zauwa¿my, ¿e kopiowanie plików z rozszerzeniem
*.tag, potrzebne jest po to by u¿ywaæ na stronach JSP&nbsp; ew.
w³asnych znaczników.<br><br>
Po wykonaniu zadania build w katalogu oznaczanym przez zmienn¹ ${build}
znajduje
sie gotowa do instalacji lub wdro¿enia struktura katalogowa naszej
aplikacji.<br> <br>
Bardzo mocn¹ w³aœciwoœci¹ Anta jest mo¿liwoœæ dowolnego rozszerzania
jego
funkcjonalnoœci przez definiowanie i implementacjê dodatkowych,
specyficznych
zadañ (jako klas Javy, zreszt¹ ca³y Ant napisany jest w Javie),<br> <br>
Takie specyficzne zadania zwi¹zane z komunikacj¹ z mened¿erem aplikacji
Tomcata
zosta³y ju¿ dla nas przygotowane - musimy je tylko w³¹czyæ do pliku
opisu
zadañ Anta (build.xml). S¹ to m.in. nastêpuj¹ce zadania:<br> <ul> <li><b>install</b>
- instalacja aplikacji - bardzo wygodne przy rozwijaniu (w obecnych
wersjach Tomcata install dzia³a jak deploy),</li> <li><b>reload</b> -
prze³adowanie aplikacji (np, po zmianie kodu klas Javy; zmiana web.xml
wymaga jednak ponownej instalacji),</li> <li><b>remove</b> - usuniêcie
zainstalowanej aplikacji,</li> <li><b>deploy</b> - wdro¿enie aplikacji.</li>
</ul>
Musimy te zadania najpierw zdefiniowaæ (bo wykorzystuj¹ zewnêtrzne
wobec Anta klasy):<br> <pre>  &lt;!-- definiowane zadania Anta dla Tomcata --&gt;
  &lt;taskdef name="install" classname="org.apache.catalina.ant.InstallTask"/&gt;
  &lt;taskdef name="reload"  classname="org.apache.catalina.ant.ReloadTask"/&gt;
  &lt;taskdef name="remove"  classname="org.apache.catalina.ant.RemoveTask"/&gt;	
  &lt;taskdef name="deploy" classname="org.apache.catalina.ant.DeployTask"/&gt;	
  &lt;taskdef name="undeploy" classname="org.apache.catalina.ant.UndeployTask"/&gt;	

</pre>
Po czym mo¿emy ich u¿yæ np.:<br> <pre>  &lt;target name="install" description="Instaluje aplikacje"
          depends="build"&gt;
    &lt;install url="\${url}" username="\${username}" password="\${password}"
          path="/\${context.path}" war="file:\${build}"/&gt;
  &lt;/target&gt;

  &lt;target name="install-config"
      description="Instaluje w oparciu o context.xml" depends="build"&gt;
     &lt;install url="\${url}" path="niewazne"
      config="file:\${app.path}/\${app}/context.xml"
      username="\${username}" password="\${password}"/&gt;
  &lt;/target&gt;


  &lt;target name="reload" description="Przeladowuje  aplikacje"
          depends="build"&gt;
    &lt;reload  url="\${url}" username="\${username}" password="\${password}"
          path="/\${context.path}"/&gt;
  &lt;/target&gt;

  &lt;target name="remove" description="Usuwa aplikacje"&gt;
    &lt;remove url="\${url}" username="\${username}" password="\${password}"
          path="/\${context.path}"/&gt;
  &lt;/target&gt;

</pre>
Uwaga:<br> <ul> <li>zmienna url zawiera lokator mened¿era aplikacji,
gdzieœ wczeœniej
mogliœmy zapisaæ &nbsp; &lt;property
name="url"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
value="http://localhost:8080/manager"/&gt;
lub pobraæ wartoœæ tej w³aœciowoœci z pliku .properties,</li> <li>zmienne
username i password to nazwa u¿ytkownikia i has³o potrzebne
do dostêpu do mened¿era aplikacji (w Tomcacie specyfikujemy te
wartoœci w pliku conf/tomcat-users.xml), zapewne wpiszemy je do pliku
build.properties,</li> <li>context.path - to okreœlona wczeœniej
œcie¿ka kontekstu, </li> <li><b>war</b> - okreœla umiejscowienie
aplikacji (w naszym przypadku jest
to niespakowana struktura katalogowa,&nbsp; znajduj¹ca
siê pod katalogiem ${build}</li> </ul> <br>
Pokazane fragmenty pliku build.xml s¹ na tyle ogólne, ¿e daj¹ siê
zastosowaæ
wlaœciwie wobec ka¿dej aplikacji zawieraj¹cej serwlety lub strony JSP.<br>
Mo¿emy zatem taki plik umieœciæ w jakimœ ogólnie dostêpnym katalogu
(np.
o nazwie common), nazwac np. <span style="font-weight: bold;">defbuild.xml</span>
i wl¹czaæ go w ka¿dym konkretnym
pliku buld.xml dla konkretnych aplikacji.<br>
We wspólnym katalogu (common) umieœcimy te¿ plik wspó³nych w³aœciwoœci
wszystkich
aplikacji (build.properties), w którym mo¿emy zapisaæ np. nazwê
u¿ytkownika
i has³o dostêpu do mened¿era aplikacji oraz œcie¿kê do instalacji
Tomcata, np:<br> <br> <pre>username=admin
password=admin
catalina.home=E:/Serwery/apache-tomcat-6.0.13

</pre>
<br>
Teraz w ka¿dym konkretnym podkatalogu przeznaczonym dla konkretnej
apliakcji
umieszczamy tylko opisu w³aœciwoœci tej aplikacji (nazwa aplikacji i
œcie¿ka
dostêpu &nbsp;- widzieliœmy ju¿ ten plik build.properties) oraz&nbsp;
plik buld.xml
w nastêpuj¹cej postaci:<br> <br> <pre>&lt;!--
    Projekt
--&gt;

&lt;!DOCTYPE project [
  &lt;!ENTITY defbuild SYSTEM "../../common/defbuild.xml"&gt;
]&gt;


&lt;project name="moja aplikacja" default="build" basedir="."&gt;
  &lt;target name="init"&gt;
      &lt;tstamp/&gt;
  &lt;/target&gt;

  &amp;defbuild;

&lt;/project&gt;

</pre>
Zapis &amp;defbuild w³¹cza zawartoœci pliku defbuild.xml z katalogu
common.<br>
Dla porz¹dku przytoczê jeszcze pe³ny zapis tego pliku:<br> <pre>  &lt;!-- Wlasciwosci dla dostepu do Managera aplikacji --&gt;
  &lt;property name="url"      value="http://localhost:8080/manager"/&gt;

       &lt;!-- Konfiguracja wlasciwosci  --&gt; 
  &lt;property file="../../common/build.properties"/&gt;
  &lt;property file="build.properties"/&gt;
  &lt;property name="build" value="\${app.path}/\${app}/build" /&gt;
  &lt;property name="context.path" value="\${app}" /&gt;


  &lt;!-- Sciezka klas dla kompilacji --&gt;

  &lt;path id="classpath"&gt;
    &lt;fileset dir="\${catalina.home}/lib"&gt;
      &lt;include name="*.jar"/&gt;
    &lt;/fileset&gt;
  &lt;/path&gt;

  &lt;!-- definiowane zadania Anta dla Tomcata --&gt;
  &lt;taskdef name="install" classname="org.apache.catalina.ant.InstallTask"/&gt;
  &lt;taskdef name="reload"  classname="org.apache.catalina.ant.ReloadTask"/&gt;
  &lt;taskdef name="remove"  classname="org.apache.catalina.ant.RemoveTask"/&gt;	
  &lt;taskdef name="deploy" classname="org.apache.catalina.ant.DeployTask"/&gt;	
  &lt;taskdef name="undeploy" classname="org.apache.catalina.ant.UndeployTask"/&gt;	


  &lt;target name="prepare" depends="init"
   	description="Buduje katalogi build"&gt;
    &lt;mkdir dir="\${build}" /&gt;
    &lt;mkdir dir="\${build}/WEB-INF" /&gt;
    &lt;mkdir dir="\${build}/WEB-INF/classes" /&gt;
    &lt;mkdir dir="\${build}/WEB-INF/lib" /&gt;	
    &lt;mkdir dir="\${build}/WEB-INF/tags" /&gt;			
  &lt;/target&gt;


  &lt;!-- wykonanie zadan --&gt;

  &lt;target name="install" description="Instaluje aplikacje"
          depends="build"&gt;
    &lt;install url="\${url}" username="\${username}" password="\${password}"
          path="/\${context.path}" war="file:\${build}"/&gt;
  &lt;/target&gt;

  &lt;target name="install-config"  
      description="Instaluje w oparciu o context.xml" depends="build"&gt;
     &lt;install url="\${url}" path="/\${context.path}" war="file:\${build}"
      config="file:\${app.path}/\${app}/context.xml"
      username="\${username}" password="\${password}"/&gt;
  &lt;/target&gt; 


  &lt;target name="reload" description="Przeladowuje  aplikacje"
          depends="build"&gt;
    &lt;reload  url="\${url}" username="\${username}" password="\${password}"
          path="/\${context.path}"/&gt;
  &lt;/target&gt;

  &lt;target name="remove" description="Usuwa aplikacje"&gt;
    &lt;remove url="\${url}" username="\${username}" password="\${password}"
          path="/\${context.path}"/&gt;
  &lt;/target&gt;


  &lt;target name="build" depends="prepare" 
     description="Kompilacja i kopiowanie" &gt;
    &lt;javac srcdir="src" destdir="\${build}/WEB-INF/classes" debug="on"&gt;
    	&lt;include name="**/*.java" /&gt;
     	&lt;classpath refid="classpath"/&gt;
    &lt;/javac&gt;
    &lt;copy todir="\${build}/WEB-INF"&gt;
      &lt;fileset dir="web/WEB-INF"    &gt;
        &lt;include name="**/*.xml" /&gt;
        &lt;include name="**/*.html" /&gt;
        &lt;include name="**/*.tld" /&gt;
        &lt;include name="**/*.properties" /&gt;
        &lt;include name="**/*.txt" /&gt;
      &lt;/fileset&gt;
    &lt;/copy&gt;
    &lt;copy todir="\${build}"&gt;
      &lt;fileset dir="web"&gt;
        &lt;include name="**/*.html" /&gt;
        &lt;include name="**/*.jsp" /&gt;
        &lt;include name="**/*.jspf" /&gt;
        &lt;include name="**/*.gif" /&gt;
      &lt;/fileset&gt;
    &lt;/copy&gt;
    &lt;copy todir="\${build}/WEB-INF/tags"&gt;
      &lt;fileset dir="web"&gt;
        &lt;include name="**/*.tag" /&gt;
      &lt;/fileset&gt;
    &lt;/copy&gt;
  &lt;/target&gt;


</pre>
oraz przyk³adowy plik build.properties (konkretnej aplikacji), np
rozwijanej w katalogu G:/webaps/SERWLETY/jsp-test<br> <br> <pre>app=jsp-test
app.path=G:/webaps/SERWLETY
</pre>
<br>
Po wywo³aniu <b>ant install</b> &nbsp;w katalogu
G:/webaps/SERWLETY/jsp-test zostanie
utworzony katalog build, skopiowane do niego odpowiednie pliki i
struktury
katalogowe i aplikacja zostanie zainstalowana w kontekœcie jsp-test
(œcie¿k¹
kontekstu aplikacji bedzie /jsp-test). Od tego momentu mo¿emy
odowo³wyac
siê do tej aplikacji.<br> <br>
Jeœli chcemy zmieniæ plik web.xml (deskryptor wdro¿enia), to po zmianie
- aplikacjê musimy przeinstalowaæ zatem:<br> <ul> <li>najpierw j¹
usun¹æ - <b>ant remove</b></li> <li>a poŸniej zainstalowaæ ponownie -
<b>ant install</b></li> </ul>
Mo¿emy równie¿ zainstalowaæ aplikacjê u¿ywaj¹c pliku deskryptora
kontekstu
(powiedzmy, ¿e nazywa siê on context.xml, tak zreszt¹ ustaliliœmy w
pliku
defbuild.xml dla Anta).&nbsp; W tym przypadku wywo³ujemy anta do
wykonania zadania
install-config:<br> <b>ant install-config </b>(zob. jego definicjê w
pliku defbuild.xml)<br> <br>
Przy instalacjach jako umiejscowienie aplikacji mo¿emy podaæ zarowno
niespakowany
katalog aplikacji, jak i plik WAR (ze zpakowanym katalogiem aplikacji).<br>
<br>
Zadanie wdro¿enia (<b>ant deploy</b>) wymaga natomiast u¿ycia wy³¹cznie
pliku
WAR, do którego wczeœniej musimy spakowaæ strukturê katalogow¹
aplikacji.
Do tego te¿ mo¿emy zastosowac Anta, przez zdefiniowanie i wykonanie
nastêpuj¹cego
zadania:<br> <br> <pre>  &lt;target name="package"
      description="Pakuje WAR"&gt;
      &lt;delete file="dist/\${war.file}" /&gt;
      &lt;jar jarfile="dist/\${war.file}" &gt;
        &lt;fileset dir="\${build}" /&gt;
      &lt;/jar&gt;
  &lt;/target&gt;

</pre>
Katalog dist jest katalogiem "dystrybucji" i musi byæ oczywiœcie
wczeœniej utworzony.<br> <br>
Tutaj raczej pozastawiamy etap wdro¿enia na boku (nie zdefiniowaliœmy
zadañ deploy i undeploy, zamaist nich u¿ywamy install i remove). Zale¿y
nam bowiem przede
wszystkim na narzêdziu, które umo¿liwi szybkie przeinstalowywanie
aplikacji
przy jej rozbudowie i testowaniau. Takie narzêdzie w³aœnie opisano, a
niezbêdne
pliki znajduj¹ sie w katalogu samples. Na koniec warto jeszcze tylko
powiedzieæ,
¿e proponowane rozwi¹zanie jest - naturalnie - jednym z mo¿liwych. Byæ
mo¿e ³atwiej jest u¿ywaæ œrodowisk w rodzaju NetBeans czy Ecliipse,
skonfigurowanego jako Eclipse for Java EE Developer. Ale stosuj¹c
w³asny skrypt Anta mo¿emy bardzo dok³adnie przeœledziæ co siê dzieje,
gdzie i jak s¹ umieszczane rózne komponenty aplikacji itp. Przejœcie na
bardziej wizualne, "wyklikiwane" rozwi¹zania jest etapem, który raczej
powinien nastêpowac po zrzoumieniu mechanizmów dzialania.<br> <br><a name="WebApps1.7"></a><h2>7.
Tworzenie i wdra¿anie aplikacji WEB w œrodowisku Eclipse</h2><br>Do
tworzenia i wdra¿ania aplikacji u¿ywamy &nbsp;œrodowiska Eclipse IDE
for JEE Developers.<br><br>A. Zdefiniowanie serwera - wybraæ opcjê New
- Servers<br><br><img style="width: 525px; height: 575px;" alt="r"
 src="images/ecljee1.jpg"><br><br><img
 style="width: 525px; height: 425px;" alt="r" src="images/ecljee2.jpg"><br>
<br>B. Utworzenie projektu &nbsp;(New ... Dynamic Web Project)<br><br><img
 style="width: 642px; height: 720px;" alt="r" src="images/ecljee3.jpg"><br><br>C.
&nbsp;Zostanie stworzona odpowiednia struktura katalogowa. Po Java
rResources mo¿emy pisac kod serwletu.<br><br><img
 style="width: 1024px; height: 768px;" alt="e" src="images/ecljee5.jpg"><br>
<br>C. Dodatkowe zasoby (obrazki, pliki html) dodajemy do WebContent<br><br><img
 style="width: 579px; height: 583px;" alt="r" src="images/ecljee6.jpg"><br><br>D.
Deskryptor kontekstu bêdzie wygenerowany automatycznie - mo¿emy go
poprawiaæ<br><br><img style="width: 995px; height: 576px;" alt="r"
 src="images/ecljee7.jpg"><br><br>E. Uruchamiamy aplikacjê w
wewnêtrznej przegl¹darce Eclipse (Run As ... Run on server)<br><br><img
 style="width: 525px; height: 521px;" alt="r" src="images/ecljee8.jpg"><br><br><img
 style="width: 525px; height: 521px;" alt="r" src="images/ecljee9.jpg"><br><br><img
 style="width: 824px; height: 867px;" alt="r" src="images/ecljee10.jpg"><br><br>F.
Eksportujemy aplikacjê do pliku WAR<br><br><img
 style="width: 824px; height: 867px;" alt="r" src="images/ecljee11.jpg"><br><br>i
wdra¿amy w srodowisku roboczym Tomcata:<br><br><img
 style="width: 920px; height: 699px;" alt="r" src="images/deployWAR.jpg"><br></body></html>